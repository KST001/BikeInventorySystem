@page "/approvedLog"
@namespace BikeInventorySystem.Data

@* Approved Log main container *@
<div class="container" style="margin-top: 70px;">
    <div class="row">
       
            <nav class="navbar navbar-dark bg-dark justify-content-between rounded-1">
            <h1 class="navbar-brand mb-0 h1">Approved Log</h1>
            </nav>
    </div>
    <div class="row mt-1">
        @* Approval log History Data Table *@
        <table class="table table-striped table-light table-hover">
            <thead>
                <tr class="table-active">
                    <th>Item name</th>
                    <th>Quantity</th>
                    <th>Taken By</th>
                    <th>Approved By</th>
                    <th>
                        Approved Date
                        <a class='btn text-@(_sortBy == "approvedDate" ? "primary" : "secondary")' data-mdb-toggle="tooltip"
                           @onclick='()=>SortByHandler("approvedDate")'>
                            <span class='oi oi-sort-@(_sortBy == "approvedDate" ? _sortDirection : "ascending")' />
                        </a>
                    </th>

                </tr>
            </thead>
            @{
                IEnumerable<ApprovedItem> approvedList = _approvedItems;
                if (_sortBy == "approvedDate")
                {
                    approvedList = _sortDirection == "ascending" ? approvedList.OrderBy(t => t.ApprovedDate) : approvedList.OrderByDescending(t =>
                    t.ApprovedDate);
                }

             }
            @* Approval Data Table Body *@
            <tbody>
                @foreach (var approvedItem in approvedList)
                {
                    <tr>
                        <td>@approvedItem.ItemName</td>
                        <td>@approvedItem.Quantity.ToString()</td>
                        <td>@approvedItem.TakerName</td>
                        <td>@approvedItem.ApproverName</td>
                        <td>@approvedItem.ApprovedDate.ToString("MMM dd, yyyy h:mm tt")</td>
                    </tr>
                }
            </tbody>
   
        </table>
    </div>
 </div>



@code {

    /* Access Modifier*/

    [CascadingParameter]
    private GlobalState _globalState { get; set; }
    private List<ApprovedItem> _approvedItems { get; set; }
    private string _sortBy = "approvedDate";
    private string _sortDirection = "ascending";


    /* OnInitialized Method*/

    protected override void OnInitialized()
    {
        _approvedItems = ApprovedItemService.GetAll(_globalState.CurrentUser.Id);
    }

    /* SortByHandler Method*/
    private void SortByHandler(string sortByName)
    {
        if (_sortBy == sortByName)
        {
            _sortDirection = _sortDirection == "ascending" ? "descending" : "ascending";
        }
        else
        {
            _sortBy = sortByName;
            _sortDirection = "ascending";
        }
    }
}

